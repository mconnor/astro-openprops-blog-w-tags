---
// import { Debug } from 'astro:components';
import Layout from '@layouts/BaseLayout.astro';
import { Box, Stack, Frame, Cluster } from '@cc/index.js';
import { getCollection } from 'astro:content';
import Card from '@components/Card.astro';

// import type { CollectionEntry } from 'astro:content'

export const prerender = true;

export const getStaticPaths = async () => {
  const allPosts = await getCollection('blog');
  const uniqueTags = [
    ...new Set(allPosts.map((post) => post.data?.tags || []).flat()),
  ];

  return uniqueTags.map((tag) => {
    const filteredPosts = allPosts.filter(
      ({ data }) => data.draft !== true && data?.tags?.includes(tag),
    );
    return {
      params: { tag },
      props: {
        posts: filteredPosts,
      },
    };
  });
};

const { tag } = Astro.params;
const { posts } = Astro.props;
---

<Layout pageTitle={tag}>
  <!-- <Debug {tag} />
  <Debug {posts} /> -->
  <Stack space="var(--s1)">
    <Box><h2>#{tag}</h2></Box>
    {posts.map((post) => <Card slug={post.slug} />)}
  </Stack>
  <!-- <TitleDate posts={posts} /> -->
</Layout>
