---
import BaseLayout from '../../layouts/BaseLayout.astro'

import { getCollection } from 'astro:content'

const allPosts = await getCollection('posts')

const tagCounts: Record<string, number> = {}

allPosts.forEach((post) => {
    ;(post.data.tags || []).forEach((tag) => {
        tagCounts[tag] = (tagCounts[tag] || 0) + 1
    })
})

const tags = Object.keys(tagCounts)
---

<BaseLayout pageTitle="Tag Index">
    <ul>
        <div class="tags">
            {
                tags.map((tag) => (
                    <p class="tag">
                        <a href={`/tags/${tag}`}>
                            {tag} <span>({tagCounts[tag]})</span>
                        </a>
                    </p>
                ))
            }
        </div>
    </ul>
</BaseLayout>

<style>
    a {
        color: #00539f;
    }

    .tags {
        display: flex;
        flex-wrap: wrap;
        margin: 0 auto;
    }

    .tag {
        margin: 0.25em;
        border: dotted 1px #a1a1a1;
        border-radius: 0.5em;
        padding: 0.5em 1em;
        font-size: 1.15em;
        background-color: #f8fcfd;
    }
</style>
